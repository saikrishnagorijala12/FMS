<div class="app">
  <header class="header">
    <div class="header-content">
      <div class="logo">üè™ FMS</div>
      <div class="logo">Customer Dashboard</div>
      <div class="user-info">
        <span>Welcome, {{ customer.name }}</span>

        <div class="user-avatar dropdown">
          <div class="rounded-circle profile-avatar dropdown-toggle d-flex justify-content-center align-items-center"
            id="profileDropdown" data-bs-toggle="dropdown" aria-expanded="false" style="cursor: pointer">
            {{ customer.name.charAt(0) }}
          </div>
          <ul class="dropdown-menu dropdown-menu-end profile-dropdown" aria-labelledby="profileDropdown">
            <li>
              <a class="dropdown-item d-flex align-items-center text-danger" (click)="logout()">
                <i class="fa fa-sign-out dropdown-icon text-danger"></i>
                <span>Logout</span>
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </header>

  <div class="container">
    <nav class="dashboard-nav">
      <button class="nav-btn" [class.active]="activeSection() === 'locations'" (click)="setActiveSection('locations')">
        üìç Locations
      </button>
      <button class="nav-btn" [class.active]="activeSection() === 'products'" (click)="setActiveSection('products')">
        üõçÔ∏è Products
      </button>

      <button class="nav-btn" [class.active]="activeSection() === 'cart'" (click)="setActiveSection('cart')">
        üõí Cart ({{ cartService.getItems().length }})
      </button>

      <button class="nav-btn" [class.active]="activeSection() === 'orders'" (click)="setActiveSection('orders')">
        üì¶ Orders
      </button>
      <button class="nav-btn" [class.active]="activeSection() === 'profile'" (click)="setActiveSection('profile')">
        üë§ Profile
      </button>
    </nav>

    <!-- Locations Section -->
    <section class="dashboard-section" [class.active]="activeSection() === 'locations'">
      <h2 class="section-title">Browse Franchise Locations</h2>

      <!-- Search -->
      <div class="search-bar">
        <input type="text" class="search-input" placeholder="Search by Name, city, or state.."
          [(ngModel)]="locationSearchTerm" (keyup.enter)="searchLocations(locationSearchTerm)" />
        <button class="search-btn" (click)="searchLocations(locationSearchTerm)">
          üîç Search
        </button>
      </div>

      <!-- Filters -->
      <div class="filter-bar">
        <select class="filter-select" [(ngModel)]="selectedState" (change)="applyLocationFilters()">
          <option value="">All States</option>
          <option *ngFor="let state of states" [value]="state">
            {{ state }}
          </option>
        </select>

        <select class="filter-select" [(ngModel)]="selectedService" (change)="applyLocationFilters()">
          <option value="">All Services</option>
          <option value="Dining">Dining Available</option>
          <option value="Delivery">Delivery Available</option>
          <option value="Pickup">Pickup Available</option>
          <option value="Catering">Catering Available</option>
        </select>
      </div>

      <!-- Locations Grid -->
      <div class="grid">
        <div class="card location-card" *ngFor="let location of filteredLocations; trackBy: trackByLocationId">
          <h4>{{ location.name }}</h4>
          <button class="btn btn-primary" (click)="openDialog(location)">
            View Details
          </button>
        </div>
      </div>

      <div class="dialog-overlay" *ngIf="selectedLocation" (click)="closeDialog()">
        <div class="dialog-box" (click)="$event.stopPropagation()">
          <div class="dialog-header">
            <h4>{{ selectedLocation.name }}</h4>
            <button class="close-btn" (click)="closeDialog()">&times;</button>
          </div>

          <div class="dialog-content">
            <p>üìç {{ selectedLocation.address }}</p>
            <p>üìû {{ selectedLocation.phone }}</p>
            <p>üïí {{ selectedLocation.hours }}</p>
            <p>‚úÖ {{ selectedLocation.services.join(" ‚Ä¢ ") }}</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Products Section -->
    <section class="dashboard-section" [class.active]="activeSection() === 'products'">
      <h2 class="section-title">Search & Purchase Products</h2>

      <div class="search-bar">
        <input type="text" class="search-input" placeholder="Search products..." [(ngModel)]="productSearchTerm"
          (keyup.enter)="searchProducts(productSearchTerm)" />
        <button class="search-btn" (click)="searchProducts(productSearchTerm)">
          üîç Search
        </button>
      </div>

      <div class="filter-bar">
        <select class="filter-select" [(ngModel)]="selectedCategory" (change)="applyFilters()">
          <option value="">All Categories</option>
          <option *ngFor="let cat of categories" [value]="cat">
            {{ cat }}
          </option>
        </select>

        <select class="filter-select" [(ngModel)]="selectedPriceRange" (change)="applyFilters()">
          <option value="">Price Range</option>
          <option value="0-10">‚Çπ0 - ‚Çπ10</option>
          <option value="10-25">‚Çπ10 - ‚Çπ25</option>
          <option value="25-50">‚Çπ25 - ‚Çπ50</option>
          <option value="50+">‚Çπ50+</option>
        </select>
      </div>
      <div class="grid">
        <div class="card product-card" *ngFor="let product of filteredProducts">
          <h3>{{ product.name }}</h3>
          <p>{{ product.description }}</p>
          <p class="price">‚Çπ{{ product.price }}</p>
          <p>‚≠ê {{ product.rating }}/5 ({{ product.reviews }} reviews)</p>
          <button class="btn btn-success" (click)="openProductDialog(product)">
            Add to Cart
          </button>
        </div>
      </div>
      <div class="dialog-overlay" *ngIf="selectedProduct" (click)="closeProductDialog()">
        <div class="dialog-box" (click)="$event.stopPropagation()">
          <div class="dialog-header">
            <h4>{{ selectedProduct.name }}</h4>
            <button class="close-btn" (click)="closeProductDialog()">&times;</button>
          </div>

          <div class="dialog-content">
            <p>{{ selectedProduct.description }}</p>
            <p>Unit Price: ‚Çπ{{ selectedProduct.price }}</p>

            <div class="quantity-section">
              <label>Quantity:</label>
              <input type="number" [(ngModel)]="productQuantity" min="1" class="qty-input" />
            </div>

            <p class="total">Total: ‚Çπ{{ productQuantity * selectedProduct.price }}</p>

            <div class="dialog-actions">
              <button class="btn btn-primary" (click)="confirmAddToCart()">
                Confirm
              </button>
              <button class="btn btn-secondary" (click)="closeProductDialog()">
                Cancel
              </button>
            </div>
          </div>
        </div>
      </div>


    </section>

    <!-- Cart Section -->
    <section class="dashboard-section" [class.active]="activeSection() === 'cart'">
      <h2 class="section-title">Your Cart</h2>

      <div class="grid">
        <div class="card cart-card" *ngFor="let item of cartService.getItems()">
          <h3>{{ item.name }}</h3>
          <p>Price: ‚Çπ{{ item.price }}</p>
          <p>Quantity: {{ item.quantity }}</p>
          <p>Subtotal: ‚Çπ{{ item.price * item.quantity }}</p>
          <button class="btn btn-danger" (click)="removeFromCart(item.id)">
            Remove
          </button>
        </div>
      </div>

      <div class="cart-summary" *ngIf="cartService.getItems().length">
        <h3>Total: ‚Çπ{{ cartService.getTotal() }}</h3>
        <button class="btn btn-primary" (click)="checkout()">Checkout</button>
        <button class="btn btn-secondary" (click)="clearCart()">
          Clear Cart
        </button>
      </div>
    </section>

    <!-- Orders Section -->
    <section class="dashboard-section" [class.active]="activeSection() === 'orders'">
      <h2 class="section-title">Track Order Status</h2>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-number">{{ orderStats().total }}</div>
          <div class="stat-label">Total Orders</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">{{ orderStats().active }}</div>
          <div class="stat-label">Active Orders</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">‚Çπ{{ orderStats().totalSpent }}</div>
          <div class="stat-label">Total Spent</div>
        </div>
      </div>

      <div class="filter-bar">
        <select class="filter-select" [(ngModel)]="selectedOrderStatus" (change)="applyOrderFilters()">
          <option value="">All Orders</option>
          <option value="pending">Pending</option>
          <option value="processing">Processing</option>
          <option value="shipped">Shipped</option>
          <option value="delivered">Delivered</option>
        </select>

        <select class="filter-select" [(ngModel)]="selectedTimeRange" (change)="applyOrderFilters()">
          <option value="">Last 30 Days</option>
          <option value="7">Last 7 Days</option>
          <option value="30">Last 30 Days</option>
          <option value="90">Last 90 Days</option>
        </select>
      </div>

      <div class="grid">
        <div class="card order-card" *ngFor="let order of filteredOrders">
          <h3>Order #{{ order.id }}</h3>
          <p>üìÖ {{ order.date }}</p>
          <p>üõçÔ∏è {{ order.items }}</p>
          <p>üí∞ Total: ‚Çπ{{ order.total }}</p>
          <p>üìç {{ order.location }}</p>
          <span class="status" [ngClass]="order.status">{{
            order.status | titlecase
            }}</span>
          <button class="btn btn-primary" (click)="trackOrder(order)">
            {{ order.status === "delivered" ? "Reorder" : "Track Order" }}
          </button>
        </div>
      </div>
    </section>

    <!-- Profile Section -->
    <section class="dashboard-section" [class.active]="activeSection() === 'profile'">
      <h2 class="section-title">Manage Profile & Order History</h2>

      <div class="profile-form">
        <div class="form-group">
          <label for="firstName">Full Name</label>
          <input type="text" id="firstName" [(ngModel)]="customer.name" />
        </div>

        <!-- <div class="form-group">
              <label for="lastName">Last Name</label>
              <input type="text" id="lastName" [(ngModel)]="user().lastName">
            </div>
             -->
        <div class="form-group">
          <label for="email">Email</label>
          <input type="email" id="email" [(ngModel)]="customer.email" />
        </div>

        <div class="form-group">
          <label for="phone">Phone</label>
          <input type="tel" id="phone" [(ngModel)]="customer.phone_no" />
        </div>

        <div class="form-group">
          <label for="address">Address</label>
          <textarea id="address" rows="3" [(ngModel)]="customer.address"></textarea>
        </div>

        <div class="form-group">
          <label for="preferences">Dietary Preferences</label>
          <select id="preferences" [(ngModel)]="customer.preferences">
            <option value="">No Restrictions</option>
            <option value="vegetarian">Vegetarian</option>
            <option value="vegan">Vegan</option>
            <option value="gluten-free">Gluten-Free</option>
            <option value="dairy-free">Dairy-Free</option>
          </select>
        </div>

        <div class="form-group">
          <label>
            <input type="checkbox" [(ngModel)]="customer.emailNotifications" />
            Email notifications for orders
          </label>
        </div>

        <div class="form-group">
          <label>
            <input type="checkbox" [(ngModel)]="customer.smsNotifications" />
            SMS notifications for delivery
          </label>
        </div>

        <button class="btn btn-primary" (click)="updateProfile()">
          Update Profile
        </button>
      </div>
    </section>
  </div>
</div>